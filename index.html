<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!doctype html>
<html lang="fr">
<head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

      <title>Un p'tit coin d'savonnerie</title>
      <meta name="description" content="Savons artisanaux et biologiques">

      <link rel="icon" href="/images/favicon.ico">

      <!-- See https://goo.gl/OOhYW5 -->
      <link rel="manifest" href="/manifest.json">

      <!-- See https://goo.gl/qRE0vM -->
      <meta name="theme-color" content="#009688">

      <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="application-name" content="Un p'tit coin d'savonnerie">

      <!-- Add to homescreen for Safari on iOS -->
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
      <meta name="apple-mobile-web-app-title" content="Un p'tit coin d'savonnerie">

      <!-- Homescreen icons -->
      <link rel="apple-touch-icon" href="/images/manifest/icon-48x48.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/manifest/icon-72x72.png">
      <link rel="apple-touch-icon" sizes="96x96" href="/images/manifest/icon-96x96.png">
      <link rel="apple-touch-icon" sizes="144x144" href="/images/manifest/icon-144x144.png">
      <link rel="apple-touch-icon" sizes="192x192" href="/images/manifest/icon-192x192.png">

      <!-- Tile icon for Windows 8 (144x144 + tile color) -->
      <meta name="msapplication-TileImage" content="/images/manifest/icon-144x144.png">
      <meta name="msapplication-TileColor" content="#009688">
      <meta name="msapplication-tap-highlight" content="no">

      <script>

      function isMSIE() {
            return !!navigator.userAgent.match(/Trident/g) || !!navigator.userAgent.match(/MSIE/g);
      }

      function getOS() {
            var OSName = "Unknown";
            if (window.navigator.userAgent.indexOf("Windows NT 10.0")!= -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Windows NT 6.2") != -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Windows NT 6.1") != -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Windows NT 6.0") != -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Windows NT 5.1") != -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Windows NT 5.0") != -1) OSName="windows";
            if (window.navigator.userAgent.indexOf("Mac")            != -1) OSName="macos";
            if (window.navigator.userAgent.indexOf("X11")            != -1) OSName="linux";
            if (window.navigator.userAgent.indexOf("Linux")          != -1) OSName="linux";

            return OSName;
      }

      function obsoleteBrowserDetected() {
            window.onload = function() {
                  document.body.removeChild(document.body.querySelector('my-app'));
                  document.body.querySelector('#obsoleteBrowser').style.display = 'block';
                  filterSuggestedBrowsers();
                  hideLoadingLayer();
            };
      }

      function filterSuggestedBrowsers() {
            var os = getOS();

            var browsers = document.body.querySelector('#select_browsers');
            var suggestions = browsers.querySelectorAll('.suggestion');

            for(var i = 0; i < suggestions.length; i++) {
                  var suggestion = suggestions[i];
                  if(!suggestion.hasAttribute(os)) browsers.removeChild(suggestion);
            }

      }

      function hideLoadingLayer() {
            var layer = document.body.querySelector('#appLoading');
            var onFinish = function() {
                  document.body.removeChild(layer);
                  document.body.classList.remove('no-overflow');
                  document.body.querySelector('my-app').showModal('disclaimer-modal');
            }
            layer.addEventListener('transitionend', onFinish);
            layer.style.opacity = 0;
      }

      function registerSw() {
            if ('serviceWorker' in navigator) {
                  navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                        var installing = registration.installing !== null;
                        var app = document.body.querySelector('my-app');
                        if(installing) {
                              app.swInstalled();
                        } else {
                              if (navigator.serviceWorker.controller) {
                                    navigator.serviceWorker.controller.onstatechange = function(e) {
                                          if (e.target.state === 'redundant') {
                                                app.newVersionAvailable();
                                          }
                                    };
                              }
                        }
                  }).catch(function(err) {
                        console.log('sw', err)
                  });
            }
      }

      (function() {
            'use strict';

            if(isMSIE()) return obsoleteBrowserDetected();

            // Setup Polymer options
            window.Polymer = {
                  dom: 'shadow',
                  lazyRegister: true
            };

            window.addEventListener('app-ready', function(e) {
                  document.body.removeChild(document.body.querySelector('#obsoleteBrowser'));
                  // Removing the loading layer
                  hideLoadingLayer();
                  // Load pre-caching Service Worker
                  registerSw();
            });

            // Load webcomponentsjs polyfill if browser does not support native Web Components

            var onload = function() {
                  // For native Imports, manually fire WebComponentsReady so user code
                  // can use the same code path for native and polyfill'd imports.
                  if (!window.HTMLImports) {
                        document.dispatchEvent(
                              new CustomEvent('WebComponentsReady', {bubbles: true})
                        );
                  }
            };
            var webComponentsSupported = (
                  'registerElement' in document
                  && 'import' in document.createElement('link')
                  && 'content' in document.createElement('template')
            );
            if (!webComponentsSupported) {
                  var script = document.createElement('script');
                  script.async = true;
                  script.src = '/bower_components/webcomponentsjs/webcomponents-lite.min.js';
                  script.onload = onload;
                  document.head.appendChild(script);
            } else {
                  onload();
            }
      })();

      </script>

      <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91492201-1', 'auto');
      ga('send', 'pageview');

      </script>

      <script async src="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js"></script>

      <link rel="import" href="/src/my-app.html">

      <style>

      html {
            background-color: #f5f5f5;
      }

      body {
            margin: 0;
            font-family: 'Noto', sans-serif;
            line-height: 1.5;
            background-color: #eeeeee;
      }

      my-app {
            font-weight: 300;
            font-family: 'Roboto', 'Noto', sans-serif;
            -webkit-font-smoothing: antialiased;
      }

      .no-overflow {
            height: 100vh;
            overflow: hidden;
      }

      .full-viewport {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
      }

      /* APP LOADING LAYER */

      #waitLogo {
            width: 150px;
            height: auto;
      }

      #appLoading {
            will-change: opacity;
            transition: opacity .4s ease;
            background-color: #263238;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
      }

      #waitLogo > g > path {
            fill: #009688;
      }

      #loading_title {
            text-transform: uppercase;
            color: white;

            margin-top: 40px;
            margin-bottom: 40px;

            display: flex;
            flex-direction: column;
            justify-content: center;
      }

      #loading_title_first {
            font-size: 1.2em;
            line-height: 0.7em;
      }

      #loading_title_second {
            font-size: 1.7em;
            line-height: 1.1em;
      }

      @media (min-width: 550px) {
            #loading_title {
                  display: block;
            }

            #loading_title_first, #loading_title_second {
                  font-size: 1.7em;
                  display: inline-block;
            }
      }

      @keyframes ripple {
            0% {
                  opacity: 0;
                  transform: scale(0.2);
            }

            50% {
                  opacity: 1;
            }

            100% {
                  opacity: 0;
                  transform: scale(1);
            }
      }

      #loading_animation {
            margin-top: 40px;
            margin-bottom: 40px;
            width: 90px;
            height: 90px;
            position: relative;
      }

      #circle_one {
            animation-duration: 2s;
            animation-delay: 1s;
            background-color: #26A69A;
      }

      #circle_two {
            background-color: #4DB6AC;
            animation-duration: 2s;
      }


      #loading_animation .circle {
            animation-name: ripple;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in;
            transform-origin: center center;
            opacity: 0;
            transform: scale(0.2);
            height: 100%;
            width: 100%;
            border-radius: 50%;
            position: absolute;
      }

      /* OBSOLETE BROWSER */

      #upgrade {
            display: none;
      }


      #obsoleteBrowser {
            display: none;
            background-color: #263238;
            color: white;
      }

      #obsoleteBrowser a {
            color: #009688;
            text-decoration: none;
      }

      #obsoleteBrowser > div {
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 20px;
            padding-right: 20px;
      }

      #obsolete_header {
            margin-top: 40px;
            margin-bottom: 15px;
            border-bottom: 1px solid white;
            text-transform: uppercase;
      }

      #obsolete_intro {
            font-size: 32px;
      }

      #obsolete_dispBrowsers > table {
            margin-left: auto;
            margin-right: auto;
      }

      .suggestion {
            padding-left: 20px;
            padding-right: 20px;
            text-transform: uppercase;
            font-size: 18px;
      }
      </style>
</head>
<body class="no-overflow">
      <my-app></my-app>

      <div id="obsoleteBrowser" class="full-viewport">
            <div id="obsolete_header">Un p'tit coin d'savonnerie</div>
            <div id="obsolete_intro">Aie !</div>
            <div id="obsolete_corps">

                  <p>Il semble que vous utilisiez Internet Explorer, et nous ne pouvons vous y assurer une bonne experience.<p>
                        <p>L'application web "Un p'tit coin d'savonnerie" repose sur des technologies compatibles uniquement avec les navigateurs internet récents et maintenus.</p>
                        <p>Nous vous recommandons d'utiliser l'un des navigateurs suivant :</p>
                        <div id="obsolete_dispBrowsers">
                              <table>
                                    <tr id="select_browsers">
                                          <td class="suggestion" windows macos linux><a href="https://www.google.fr/chrome/browser/desktop/index.html" target="blank">Chrome</a></td>
                                          <td class="suggestion" windows macos linux><a href="https://www.mozilla.org/fr/firefox/new/" target="blank">Firefox</a></td>
                                          <td class="suggestion" windows><a href="https://www.microsoft.com/fr-fr/windows/microsoft-edge" target="blank">Edge</a></td>
                                          <td class="suggestion" macos><a href="http://www.apple.com/fr/safari/" target="blank">Safari</a></td>
                                    </tr>
                              </table>
                        </div>
                        <p>Apprenez en plus sur <a href="https://www.wikiwand.com/fr/Navigateur_web" target="blank">les navigateurs internet</a> ou sur <a href="https://www.microsoft.com/fr-fr/windowsforbusiness/end-of-ie-support" target="blank">l'arrêt du support d'Internet Explorer</a> si vous désirez plus de détails.</p>
                  </div>
                  <div id="obsolete_signature">
                        <p>En espérant vous revoir très bientôt !</p>
                  </div>
            </div>

            <div id="appLoading" class="full-viewport">
                  <div id="loading_title"><div id="loading_title_first">Un p'tit coin&nbsp;</div><div id="loading_title_second">d'savonnerie</div></div>

                  <svg id="waitLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 24 24">
                        <g><path d="M19 4h-4L7.11 16.63 4.5 12 9 4H5L.5 12 5 20h4l7.89-12.63L19.5 12 15 20h4l4.5-8z"/></g>
                  </svg>

                  <div id="loading_animation">
                        <div id="circle_one" class="circle"></div>
                        <div id="circle_two" class="circle"></div>
                  </div>
            </div>
      </body>
      </html>
